<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Graph-Based Agent Coordination</title>
<style>
  :root {
    --bg: #0f1117;
    --bg2: #1a1d27;
    --bg3: #242836;
    --text: #e2e8f0;
    --text2: #94a3b8;
    --accent: #60a5fa;
    --claude: #d97706;
    --codex: #22c55e;
    --gemini: #a78bfa;
    --dynamic: #f97316;
    --replace: #60a5fa;
    --accumulate: #f59e0b;
    --aggregate: #a78bfa;
    --none: #64748b;
    --success: #22c55e;
    --fail: #ef4444;
    --border: #334155;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
    background: var(--bg);
    color: var(--text);
    line-height: 1.6;
    overflow-x: hidden;
  }

  .container { max-width: 1100px; margin: 0 auto; padding: 0 24px; }

  /* Hero */
  .hero {
    text-align: center;
    padding: 80px 0 60px;
    background: linear-gradient(180deg, #1e2330 0%, var(--bg) 100%);
  }
  .hero h1 { font-size: 2.8rem; font-weight: 700; letter-spacing: -0.03em; margin-bottom: 16px; }
  .hero h1 span { background: linear-gradient(135deg, var(--accent), var(--gemini)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
  .hero p { font-size: 1.15rem; color: var(--text2); max-width: 640px; margin: 0 auto; }

  /* Sections */
  section { padding: 64px 0; }
  section + section { border-top: 1px solid var(--border); }
  .section-title {
    font-size: 1.6rem; font-weight: 600; margin-bottom: 8px;
  }
  .section-desc { color: var(--text2); margin-bottom: 32px; font-size: 1rem; }

  /* Pattern Cards */
  .pattern-grid { display: flex; flex-direction: column; gap: 48px; }
  .pattern-card {
    background: var(--bg2);
    border: 1px solid var(--border);
    border-radius: 16px;
    overflow: hidden;
  }
  .pattern-header {
    display: flex; align-items: center; justify-content: space-between;
    padding: 20px 24px;
    border-bottom: 1px solid var(--border);
  }
  .pattern-header h3 { font-size: 1.2rem; font-weight: 600; }
  .pattern-tag {
    font-size: 0.75rem; padding: 4px 10px; border-radius: 99px;
    font-weight: 500; text-transform: uppercase; letter-spacing: 0.05em;
  }
  .tag-pipeline { background: rgba(96,165,250,0.15); color: var(--replace); }
  .tag-parallel { background: rgba(167,139,250,0.15); color: var(--gemini); }
  .tag-dynamic { background: rgba(249,115,22,0.15); color: var(--dynamic); }

  .pattern-body { padding: 32px 24px; display: flex; align-items: center; gap: 32px; flex-wrap: wrap; }
  .pattern-svg-wrap { flex: 1 1 500px; min-width: 300px; }
  .pattern-info { flex: 1 1 260px; min-width: 240px; }
  .pattern-info p { color: var(--text2); margin-bottom: 16px; font-size: 0.95rem; }

  .run-btn {
    display: inline-flex; align-items: center; gap: 8px;
    padding: 10px 20px; border-radius: 8px;
    background: var(--accent); color: #fff; border: none;
    font-size: 0.9rem; font-weight: 600; cursor: pointer;
    transition: all 0.2s;
  }
  .run-btn:hover { filter: brightness(1.15); transform: translateY(-1px); }
  .run-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
  .run-btn svg { width: 16px; height: 16px; }

  /* SVG Graphs */
  svg.graph { width: 100%; height: auto; }
  svg.graph text { font-family: inherit; }

  .node-rect {
    rx: 10; ry: 10;
    stroke-width: 2;
    transition: all 0.3s;
  }
  .node-rect.idle { fill: var(--bg3); stroke: var(--border); }
  .node-rect.running { stroke: var(--accent); stroke-width: 3; filter: drop-shadow(0 0 8px rgba(96,165,250,0.5)); }
  .node-rect.done { fill: rgba(34,197,94,0.12); stroke: var(--success); }

  .node-label { fill: var(--text); font-size: 13px; font-weight: 600; text-anchor: middle; dominant-baseline: central; pointer-events: none; }
  .backend-badge { font-size: 9.5px; font-weight: 600; text-anchor: middle; dominant-baseline: central; pointer-events: none; }

  .edge-line { stroke: var(--border); stroke-width: 2; fill: none; marker-end: url(#arrow); transition: stroke 0.3s; }
  .edge-line.active { stroke: var(--accent); stroke-width: 2.5; }
  .edge-line.done { stroke: var(--success); }
  .edge-label { fill: var(--text2); font-size: 10px; text-anchor: middle; dominant-baseline: central; }

  .special-node { fill: var(--bg); stroke: var(--border); stroke-width: 1.5; stroke-dasharray: 6 3; }

  .packet {
    r: 5; fill: var(--accent); opacity: 0;
    filter: drop-shadow(0 0 4px rgba(96,165,250,0.8));
  }

  /* Context Policies */
  .policy-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 20px; }
  .policy-card {
    background: var(--bg2); border: 1px solid var(--border); border-radius: 12px;
    padding: 24px; position: relative; overflow: hidden;
  }
  .policy-card::before {
    content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3px;
  }
  .policy-card.replace::before { background: var(--replace); }
  .policy-card.accumulate::before { background: var(--accumulate); }
  .policy-card.aggregate::before { background: var(--aggregate); }
  .policy-card.none::before { background: var(--none); }
  .policy-card h4 { font-size: 1rem; font-weight: 600; margin-bottom: 6px; font-family: 'SF Mono', 'Fira Code', monospace; }
  .policy-card .use-case { font-size: 0.8rem; color: var(--text2); margin-bottom: 12px; }
  .policy-card .viz {
    background: var(--bg); border-radius: 8px; padding: 12px;
    font-family: 'SF Mono', 'Fira Code', monospace; font-size: 0.78rem;
    line-height: 1.5; color: var(--text2);
  }
  .policy-card .viz .highlight { color: var(--text); font-weight: 600; }

  /* A2A Lifecycle */
  .lifecycle-wrap { display: flex; gap: 40px; flex-wrap: wrap; align-items: flex-start; }
  .lifecycle-svg { flex: 1 1 480px; min-width: 300px; }
  .envelope-card {
    flex: 1 1 300px; min-width: 260px;
    background: var(--bg2); border: 1px solid var(--border); border-radius: 12px; padding: 24px;
  }
  .envelope-card h4 { font-size: 1rem; margin-bottom: 12px; font-family: 'SF Mono', 'Fira Code', monospace; color: var(--accent); }
  .envelope-field { display: flex; gap: 12px; padding: 6px 0; border-bottom: 1px solid var(--border); font-size: 0.85rem; }
  .envelope-field:last-child { border-bottom: none; }
  .field-name { font-family: 'SF Mono', 'Fira Code', monospace; color: var(--gemini); min-width: 120px; }
  .field-desc { color: var(--text2); }

  /* Engine Steps */
  .engine-steps { display: flex; flex-wrap: wrap; gap: 0; justify-content: center; align-items: center; }
  .engine-step {
    background: var(--bg2); border: 1px solid var(--border); border-radius: 10px;
    padding: 16px 20px; text-align: center; min-width: 120px;
  }
  .engine-step .step-icon { font-size: 1.5rem; margin-bottom: 6px; }
  .engine-step .step-label { font-size: 0.85rem; font-weight: 600; }
  .engine-step .step-detail { font-size: 0.75rem; color: var(--text2); margin-top: 4px; }
  .engine-arrow { color: var(--text2); font-size: 1.4rem; padding: 0 4px; }

  /* Backend badges */
  .backends-row { display: flex; gap: 24px; justify-content: center; flex-wrap: wrap; margin-top: 12px; }
  .backend-item {
    display: flex; align-items: center; gap: 10px;
    background: var(--bg2); border: 1px solid var(--border); border-radius: 10px;
    padding: 16px 24px;
  }
  .backend-dot { width: 12px; height: 12px; border-radius: 50%; }
  .backend-dot.claude { background: var(--claude); }
  .backend-dot.codex { background: var(--codex); }
  .backend-dot.gemini { background: var(--gemini); }
  .backend-item .bname { font-weight: 600; font-size: 0.95rem; }
  .backend-item .bmodel { font-size: 0.8rem; color: var(--text2); }

  /* Footer */
  footer { text-align: center; padding: 40px 0; color: var(--text2); font-size: 0.85rem; border-top: 1px solid var(--border); }

  @media (max-width: 640px) {
    .hero h1 { font-size: 1.8rem; }
    .pattern-body { flex-direction: column; }
    .lifecycle-wrap { flex-direction: column; }
  }
</style>
</head>
<body>

<!-- ============ Hero ============ -->
<div class="hero">
  <div class="container">
    <h1><span>Graph-Based</span> Agent Coordination</h1>
    <p>Declare agents as nodes and data flow as edges. The graph engine handles execution order, parallelism, dynamic expansion, and context passing &mdash; all from a single YAML file.</p>
  </div>
</div>

<!-- ============ Three Patterns ============ -->
<section>
<div class="container">
  <h2 class="section-title">Coordination Patterns</h2>
  <p class="section-desc">All three classic patterns are special cases of the graph. Click <strong>Run</strong> to see the execution flow.</p>

  <div class="pattern-grid">

    <!-- ── Pipeline ── -->
    <div class="pattern-card">
      <div class="pattern-header">
        <h3>Pipeline</h3>
        <span class="pattern-tag tag-pipeline">Sequential</span>
      </div>
      <div class="pattern-body">
        <div class="pattern-svg-wrap">
          <svg class="graph" id="svg-pipeline" viewBox="0 0 620 120">
            <defs>
              <marker id="arrow" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="7" markerHeight="7" orient="auto-start-reverse">
                <path d="M 0 0 L 10 5 L 0 10 z" fill="var(--border)"/>
              </marker>
              <marker id="arrow-active" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="7" markerHeight="7" orient="auto-start-reverse">
                <path d="M 0 0 L 10 5 L 0 10 z" fill="var(--accent)"/>
              </marker>
              <marker id="arrow-done" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="7" markerHeight="7" orient="auto-start-reverse">
                <path d="M 0 0 L 10 5 L 0 10 z" fill="var(--success)"/>
              </marker>
            </defs>
            <!-- _input -->
            <circle cx="20" cy="60" r="14" class="special-node"/>
            <text x="20" y="60" class="node-label" style="font-size:9px;">_in</text>
            <!-- Researcher -->
            <rect x="70" y="30" width="120" height="60" class="node-rect idle" data-node="p-researcher"/>
            <text x="130" y="55" class="node-label">Researcher</text>
            <text x="130" y="72" class="backend-badge" fill="var(--codex)">codex</text>
            <!-- Writer -->
            <rect x="230" y="30" width="120" height="60" class="node-rect idle" data-node="p-writer"/>
            <text x="290" y="55" class="node-label">Writer</text>
            <text x="290" y="72" class="backend-badge" fill="var(--claude)">claude</text>
            <!-- Reviewer -->
            <rect x="390" y="30" width="120" height="60" class="node-rect idle" data-node="p-reviewer"/>
            <text x="450" y="55" class="node-label">Reviewer</text>
            <text x="450" y="72" class="backend-badge" fill="var(--gemini)">gemini</text>
            <!-- _output -->
            <circle cx="550" cy="60" r="14" class="special-node"/>
            <text x="550" y="60" class="node-label" style="font-size:9px;">_out</text>
            <!-- Edges -->
            <line x1="34" y1="60" x2="68" y2="60" class="edge-line" data-edge="p-e0"/>
            <line x1="190" y1="60" x2="228" y2="60" class="edge-line" data-edge="p-e1"/>
            <text x="209" y="50" class="edge-label">replace</text>
            <line x1="350" y1="60" x2="388" y2="60" class="edge-line" data-edge="p-e2"/>
            <text x="369" y="50" class="edge-label">replace</text>
            <line x1="510" y1="60" x2="536" y2="60" class="edge-line" data-edge="p-e3"/>
          </svg>
        </div>
        <div class="pattern-info">
          <p>Each agent's output <strong>replaces</strong> the context for the next. Research flows to writing, writing flows to review.</p>
          <button class="run-btn" onclick="runPipeline()"><svg viewBox="0 0 24 24" fill="currentColor"><polygon points="5,3 19,12 5,21"/></svg> Run</button>
        </div>
      </div>
    </div>

    <!-- ── Parallel ── -->
    <div class="pattern-card">
      <div class="pattern-header">
        <h3>Parallel Fan-Out / Fan-In</h3>
        <span class="pattern-tag tag-parallel">Concurrent</span>
      </div>
      <div class="pattern-body">
        <div class="pattern-svg-wrap">
          <svg class="graph" id="svg-parallel" viewBox="0 0 620 200">
            <use href="#arrow"/><use href="#arrow-active"/><use href="#arrow-done"/>
            <!-- _input -->
            <circle cx="30" cy="100" r="14" class="special-node"/>
            <text x="30" y="100" class="node-label" style="font-size:9px;">_in</text>
            <!-- Backend Expert -->
            <rect x="100" y="20" width="150" height="56" class="node-rect idle" data-node="par-backend"/>
            <text x="175" y="43" class="node-label">Backend Expert</text>
            <text x="175" y="60" class="backend-badge" fill="var(--codex)">codex</text>
            <!-- Frontend Expert -->
            <rect x="100" y="124" width="150" height="56" class="node-rect idle" data-node="par-frontend"/>
            <text x="175" y="147" class="node-label">Frontend Expert</text>
            <text x="175" y="164" class="backend-badge" fill="var(--claude)">claude</text>
            <!-- Synthesizer -->
            <rect x="340" y="44" width="150" height="56" class="node-rect idle" data-node="par-synth"/>
            <text x="415" y="67" class="node-label">Synthesizer</text>
            <text x="415" y="84" class="backend-badge" fill="var(--gemini)">gemini</text>
            <!-- _output -->
            <circle cx="560" cy="72" r="14" class="special-node"/>
            <text x="560" y="72" class="node-label" style="font-size:9px;">_out</text>
            <!-- Edges -->
            <line x1="44" y1="90" x2="98" y2="52" class="edge-line" data-edge="par-e0"/>
            <line x1="44" y1="110" x2="98" y2="148" class="edge-line" data-edge="par-e1"/>
            <line x1="250" y1="48" x2="338" y2="62" class="edge-line" data-edge="par-e2"/>
            <text x="290" y="44" class="edge-label">aggregate</text>
            <line x1="250" y1="152" x2="338" y2="84" class="edge-line" data-edge="par-e3"/>
            <text x="290" y="132" class="edge-label">aggregate</text>
            <line x1="490" y1="72" x2="546" y2="72" class="edge-line" data-edge="par-e4"/>
          </svg>
        </div>
        <div class="pattern-info">
          <p>Experts work <strong>concurrently</strong>. Their outputs are <strong>aggregated</strong> with labels and fed to the synthesizer.</p>
          <button class="run-btn" onclick="runParallel()"><svg viewBox="0 0 24 24" fill="currentColor"><polygon points="5,3 19,12 5,21"/></svg> Run</button>
        </div>
      </div>
    </div>

    <!-- ── Plan-Execute ── -->
    <div class="pattern-card">
      <div class="pattern-header">
        <h3>Plan-Execute (Dynamic)</h3>
        <span class="pattern-tag tag-dynamic">Expanding</span>
      </div>
      <div class="pattern-body">
        <div class="pattern-svg-wrap">
          <svg class="graph" id="svg-planexec" viewBox="0 0 620 220">
            <use href="#arrow"/><use href="#arrow-active"/><use href="#arrow-done"/>
            <!-- _input -->
            <circle cx="30" cy="110" r="14" class="special-node"/>
            <text x="30" y="110" class="node-label" style="font-size:9px;">_in</text>
            <!-- Planner (dynamic) -->
            <rect x="80" y="80" width="130" height="60" class="node-rect idle" data-node="pe-planner" style="stroke-dasharray:6 3;"/>
            <text x="145" y="103" class="node-label">Planner</text>
            <text x="145" y="122" class="backend-badge" fill="var(--dynamic)">dynamic</text>
            <!-- Expanded subtasks -->
            <rect x="270" y="16" width="140" height="44" class="node-rect idle" data-node="pe-exec1" rx="8" ry="8"/>
            <text x="340" y="38" class="node-label" style="font-size:11px;">Executor (1)</text>
            <rect x="270" y="76" width="140" height="44" class="node-rect idle" data-node="pe-exec2" rx="8" ry="8"/>
            <text x="340" y="98" class="node-label" style="font-size:11px;">Executor (2)</text>
            <rect x="270" y="136" width="140" height="44" class="node-rect idle" data-node="pe-exec3" rx="8" ry="8"/>
            <text x="340" y="158" class="node-label" style="font-size:11px;">Executor (3)</text>
            <text x="340" y="198" class="backend-badge" fill="var(--claude)" style="font-size:10px;">claude &middot; sequential &middot; accumulate</text>
            <!-- _output -->
            <circle cx="480" cy="110" r="14" class="special-node"/>
            <text x="480" y="110" class="node-label" style="font-size:9px;">_out</text>
            <!-- Edges -->
            <line x1="44" y1="110" x2="78" y2="110" class="edge-line" data-edge="pe-e0"/>
            <!-- Planner to subtasks (dashed fan-out) -->
            <line x1="210" y1="96" x2="268" y2="40" class="edge-line" data-edge="pe-e1" style="stroke-dasharray:4 3;"/>
            <line x1="210" y1="110" x2="268" y2="98" class="edge-line" data-edge="pe-e2" style="stroke-dasharray:4 3;"/>
            <line x1="210" y1="124" x2="268" y2="158" class="edge-line" data-edge="pe-e3" style="stroke-dasharray:4 3;"/>
            <!-- Subtask chain (accumulate arrows) -->
            <path d="M 340 60 L 340 74" class="edge-line" data-edge="pe-chain1" style="stroke-dasharray:3 2;"/>
            <path d="M 340 120 L 340 134" class="edge-line" data-edge="pe-chain2" style="stroke-dasharray:3 2;"/>
            <text x="362" y="70" class="edge-label" style="font-size:8px;">acc.</text>
            <text x="362" y="130" class="edge-label" style="font-size:8px;">acc.</text>
            <!-- Last executor to output -->
            <line x1="410" y1="158" x2="466" y2="114" class="edge-line" data-edge="pe-e4"/>
          </svg>
        </div>
        <div class="pattern-info">
          <p>A <strong>dynamic</strong> planner calls an LLM to break the task into subtasks. The executor runs each <strong>sequentially</strong> with <strong>accumulating</strong> context.</p>
          <button class="run-btn" onclick="runPlanExec()"><svg viewBox="0 0 24 24" fill="currentColor"><polygon points="5,3 19,12 5,21"/></svg> Run</button>
        </div>
      </div>
    </div>

  </div>
</div>
</section>

<!-- ============ Context Policies ============ -->
<section>
<div class="container">
  <h2 class="section-title">Context Policies</h2>
  <p class="section-desc">Each edge carries a policy that controls what context the downstream node receives.</p>

  <div class="policy-grid">
    <div class="policy-card replace">
      <h4>replace</h4>
      <div class="use-case">Pipeline stages</div>
      <div class="viz">
        <div>Step 1 output: <span class="highlight">"Research findings..."</span></div>
        <div>Step 2 output: <span class="highlight">"Draft article..."</span></div>
        <div style="margin-top:8px; color: var(--replace);">Downstream receives:<br><span class="highlight">"Draft article..."</span></div>
      </div>
    </div>
    <div class="policy-card accumulate">
      <h4>accumulate</h4>
      <div class="use-case">Plan-execute sequential tasks</div>
      <div class="viz">
        <div>Step 1: <span class="highlight">"Set up Flask"</span></div>
        <div>Step 2: <span class="highlight">"Add routes"</span></div>
        <div style="margin-top:8px; color: var(--accumulate);">Downstream receives:<br>
          <span class="highlight">Completed: Set up Flask<br>Result: ...<br><br>Completed: Add routes<br>Result: ...</span>
        </div>
      </div>
    </div>
    <div class="policy-card aggregate">
      <h4>aggregate</h4>
      <div class="use-case">Parallel &rarr; synthesizer</div>
      <div class="viz">
        <div>[backend_expert]: <span class="highlight">"Use PostgreSQL..."</span></div>
        <div>[frontend_expert]: <span class="highlight">"Use React..."</span></div>
        <div style="margin-top:8px; color: var(--aggregate);">Downstream receives:<br>
          <span class="highlight">[backend_expert]:<br>Use PostgreSQL...<br>---<br>[frontend_expert]:<br>Use React...</span>
        </div>
      </div>
    </div>
    <div class="policy-card none">
      <h4>none</h4>
      <div class="use-case">Independent parallel workers</div>
      <div class="viz">
        <div>Previous output: <span class="highlight">"..."</span></div>
        <div style="margin-top:8px; color: var(--none);">Downstream receives:<br><span class="highlight">(only the original task)</span></div>
      </div>
    </div>
  </div>
</div>
</section>

<!-- ============ A2A Envelope ============ -->
<section>
<div class="container">
  <h2 class="section-title">A2A Envelope Lifecycle</h2>
  <p class="section-desc">Each node execution wraps data in a TaskEnvelope that tracks state and provenance as it flows through the graph.</p>

  <div class="lifecycle-wrap">
    <div class="lifecycle-svg">
      <svg viewBox="0 0 500 200" class="graph">
        <!-- States -->
        <rect x="20" y="70" width="110" height="50" rx="25" ry="25" fill="var(--bg3)" stroke="var(--border)" stroke-width="2"/>
        <text x="75" y="100" class="node-label" style="font-size:12px;">submitted</text>

        <rect x="180" y="70" width="110" height="50" rx="25" ry="25" fill="rgba(96,165,250,0.12)" stroke="var(--accent)" stroke-width="2"/>
        <text x="235" y="100" class="node-label" style="font-size:12px; fill:var(--accent);">working</text>

        <rect x="360" y="30" width="120" height="50" rx="25" ry="25" fill="rgba(34,197,94,0.12)" stroke="var(--success)" stroke-width="2"/>
        <text x="420" y="60" class="node-label" style="font-size:12px; fill:var(--success);">completed</text>

        <rect x="360" y="110" width="120" height="50" rx="25" ry="25" fill="rgba(239,68,68,0.12)" stroke="var(--fail)" stroke-width="2"/>
        <text x="420" y="140" class="node-label" style="font-size:12px; fill:var(--fail);">failed</text>

        <!-- Arrows -->
        <line x1="130" y1="95" x2="178" y2="95" class="edge-line" marker-end="url(#arrow)"/>
        <line x1="290" y1="82" x2="358" y2="58" class="edge-line" marker-end="url(#arrow)"/>
        <line x1="290" y1="108" x2="358" y2="132" class="edge-line" marker-end="url(#arrow)"/>

        <!-- Labels on arrows -->
        <text x="154" y="86" class="edge-label">run()</text>
        <text x="320" y="58" class="edge-label">success</text>
        <text x="320" y="130" class="edge-label">error</text>
      </svg>
    </div>
    <div class="envelope-card">
      <h4>TaskEnvelope</h4>
      <div class="envelope-field"><span class="field-name">task_id</span><span class="field-desc">UUID per node execution</span></div>
      <div class="envelope-field"><span class="field-name">context_id</span><span class="field-desc">UUID per graph run (shared)</span></div>
      <div class="envelope-field"><span class="field-name">parent_task_ids</span><span class="field-desc">Provenance: upstream task IDs</span></div>
      <div class="envelope-field"><span class="field-name">task</span><span class="field-desc">The task string</span></div>
      <div class="envelope-field"><span class="field-name">context</span><span class="field-desc">Built from edge context_policy</span></div>
      <div class="envelope-field"><span class="field-name">state</span><span class="field-desc">submitted | working | completed | failed</span></div>
      <div class="envelope-field"><span class="field-name">node_id</span><span class="field-desc">Which graph node is executing</span></div>
      <div class="envelope-field"><span class="field-name">result</span><span class="field-desc">AgentResult after completion</span></div>
    </div>
  </div>
</div>
</section>

<!-- ============ Execution Engine ============ -->
<section>
<div class="container">
  <h2 class="section-title">Execution Engine</h2>
  <p class="section-desc">From YAML definition to final result &mdash; the six stages of graph execution.</p>

  <div class="engine-steps">
    <div class="engine-step">
      <div class="step-icon">&#128196;</div>
      <div class="step-label">YAML</div>
      <div class="step-detail">Graph definition</div>
    </div>
    <div class="engine-arrow">&rarr;</div>
    <div class="engine-step">
      <div class="step-icon">&#9881;&#65039;</div>
      <div class="step-label">Parse</div>
      <div class="step-detail">GraphDef + NodeDef + EdgeDef</div>
    </div>
    <div class="engine-arrow">&rarr;</div>
    <div class="engine-step">
      <div class="step-icon">&#9989;</div>
      <div class="step-label">Validate</div>
      <div class="step-detail">Refs, cycles, dynamic config</div>
    </div>
    <div class="engine-arrow">&rarr;</div>
    <div class="engine-step">
      <div class="step-icon">&#128256;</div>
      <div class="step-label">Topo Sort</div>
      <div class="step-detail">Kahn's algorithm</div>
    </div>
    <div class="engine-arrow">&rarr;</div>
    <div class="engine-step">
      <div class="step-icon">&#9879;&#65039;</div>
      <div class="step-label">Group</div>
      <div class="step-detail">Parallel groups</div>
    </div>
    <div class="engine-arrow">&rarr;</div>
    <div class="engine-step">
      <div class="step-icon">&#9889;</div>
      <div class="step-label">Execute</div>
      <div class="step-detail">ThreadPoolExecutor</div>
    </div>
    <div class="engine-arrow">&rarr;</div>
    <div class="engine-step">
      <div class="step-icon">&#127919;</div>
      <div class="step-label">Result</div>
      <div class="step-detail">CoordinatorResult</div>
    </div>
  </div>
</div>
</section>

<!-- ============ Multi-Backend ============ -->
<section>
<div class="container">
  <h2 class="section-title">Multi-Backend Support</h2>
  <p class="section-desc">Mix and match backends within a single graph. Each node can use a different LLM provider.</p>
  <div class="backends-row">
    <div class="backend-item">
      <div class="backend-dot codex"></div>
      <div>
        <div class="bname">Codex CLI</div>
        <div class="bmodel">codex exec --json</div>
      </div>
    </div>
    <div class="backend-item">
      <div class="backend-dot claude"></div>
      <div>
        <div class="bname">Claude Code</div>
        <div class="bmodel">claude -p --output-format stream-json</div>
      </div>
    </div>
    <div class="backend-item">
      <div class="backend-dot gemini"></div>
      <div>
        <div class="bname">Gemini CLI</div>
        <div class="bmodel">gemini --model ...</div>
      </div>
    </div>
  </div>
</div>
</section>

<footer>
  <div class="container">agent-coordination &mdash; graph-based multi-agent coordination with A2A protocol</div>
</footer>

<script>
// Animation helpers
function sleep(ms) { return new Promise(r => setTimeout(r, ms)); }

function setNodeState(sel, state) {
  const el = document.querySelector(`[data-node="${sel}"]`);
  if (!el) return;
  el.classList.remove('idle', 'running', 'done');
  el.classList.add(state);
}

function setEdgeState(sel, state) {
  const el = document.querySelector(`[data-edge="${sel}"]`);
  if (!el) return;
  el.classList.remove('active', 'done');
  if (state) el.classList.add(state);
  // Update marker
  if (state === 'active') el.setAttribute('marker-end', 'url(#arrow-active)');
  else if (state === 'done') el.setAttribute('marker-end', 'url(#arrow-done)');
  else el.setAttribute('marker-end', 'url(#arrow)');
}

function resetAll(prefix, nodes, edges) {
  nodes.forEach(n => setNodeState(prefix + n, 'idle'));
  edges.forEach((_, i) => setEdgeState(prefix + 'e' + i, ''));
  // Also reset chain edges for plan-exec
  setEdgeState(prefix + 'chain1', '');
  setEdgeState(prefix + 'chain2', '');
}

function disableBtn(btn, disable) {
  btn.disabled = disable;
}

// Pipeline animation
async function runPipeline() {
  const btn = event.target.closest('.run-btn');
  disableBtn(btn, true);
  const P = 'p-';
  const nodes = ['researcher', 'writer', 'reviewer'];
  const edges = [0,1,2,3];
  resetAll(P, nodes, edges);
  await sleep(200);

  // _input -> researcher
  setEdgeState(P+'e0', 'active');
  await sleep(300);
  setEdgeState(P+'e0', 'done');

  for (let i = 0; i < nodes.length; i++) {
    setNodeState(P + nodes[i], 'running');
    await sleep(800);
    setNodeState(P + nodes[i], 'done');
    setEdgeState(P + 'e' + (i+1), 'active');
    await sleep(300);
    setEdgeState(P + 'e' + (i+1), 'done');
  }

  await sleep(500);
  disableBtn(btn, false);
}

// Parallel animation
async function runParallel() {
  const btn = event.target.closest('.run-btn');
  disableBtn(btn, true);
  const P = 'par-';
  resetAll(P, ['backend', 'frontend', 'synth'], [0,1,2,3,4]);
  await sleep(200);

  // Fan-out
  setEdgeState(P+'e0', 'active');
  setEdgeState(P+'e1', 'active');
  await sleep(300);
  setEdgeState(P+'e0', 'done');
  setEdgeState(P+'e1', 'done');

  // Both experts run concurrently
  setNodeState(P+'backend', 'running');
  setNodeState(P+'frontend', 'running');
  await sleep(1000);

  // Backend finishes first
  setNodeState(P+'backend', 'done');
  setEdgeState(P+'e2', 'active');
  await sleep(400);
  setEdgeState(P+'e2', 'done');

  // Frontend finishes
  setNodeState(P+'frontend', 'done');
  setEdgeState(P+'e3', 'active');
  await sleep(300);
  setEdgeState(P+'e3', 'done');

  // Synthesizer
  setNodeState(P+'synth', 'running');
  await sleep(900);
  setNodeState(P+'synth', 'done');
  setEdgeState(P+'e4', 'active');
  await sleep(300);
  setEdgeState(P+'e4', 'done');

  await sleep(500);
  disableBtn(btn, false);
}

// Plan-Execute animation
async function runPlanExec() {
  const btn = event.target.closest('.run-btn');
  disableBtn(btn, true);
  const P = 'pe-';
  resetAll(P, ['planner', 'exec1', 'exec2', 'exec3'], [0,1,2,3,4]);
  await sleep(200);

  // _input -> planner
  setEdgeState(P+'e0', 'active');
  await sleep(300);
  setEdgeState(P+'e0', 'done');

  // Planner runs (dynamic)
  setNodeState(P+'planner', 'running');
  await sleep(1000);
  setNodeState(P+'planner', 'done');

  // Fan-out to subtasks (dashed)
  setEdgeState(P+'e1', 'active');
  setEdgeState(P+'e2', 'active');
  setEdgeState(P+'e3', 'active');
  await sleep(400);
  setEdgeState(P+'e1', 'done');
  setEdgeState(P+'e2', 'done');
  setEdgeState(P+'e3', 'done');

  // Sequential execution with accumulate
  const execs = ['exec1', 'exec2', 'exec3'];
  const chains = ['chain1', 'chain2'];
  for (let i = 0; i < execs.length; i++) {
    setNodeState(P + execs[i], 'running');
    await sleep(700);
    setNodeState(P + execs[i], 'done');
    if (i < chains.length) {
      setEdgeState(P + chains[i], 'active');
      await sleep(250);
      setEdgeState(P + chains[i], 'done');
    }
  }

  // -> _output
  setEdgeState(P+'e4', 'active');
  await sleep(300);
  setEdgeState(P+'e4', 'done');

  await sleep(500);
  disableBtn(btn, false);
}
</script>
</body>
</html>
